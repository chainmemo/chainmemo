import { createApp } from 'vue'
import App from './App.vue'
import router from './router'
import './index.css'


/*

deploy logic 
fill logic's address into sol file
copy proxy bytecode and factory bytecode
deploy factory
fill factory's address below

 */

window.FactoryAddress = "0x6740814B17eD1F4534491f5fB1eEa0cD5341bfca"

window.ISODateExample = "2009-01-03T06:15:00.000Z"

window.logicBytecode = "0x608060405234801561001057600080fd5b50610648806100206000396000f3fe608060405234801561001057600080fd5b50600436106100575760003560e01c80635fec398d1461005c5780636f41d28e1461007157806375f3147014610084578063f0fa2fe5146100ad578063fa239b1e146100c0575b600080fd5b61006f61006a3660046104a6565b6100d1565b005b61006f61007f366004610518565b610162565b610097610092366004610518565b61024c565b6040516100a49190610531565b60405180910390f35b61006f6100bb3660046104a6565b6102fb565b6001546040519081526020016100a4565b60005461010090046001600160a01b031633146101215760405162461bcd60e51b81526020600482015260096024820152683737ba16b7bbb732b960b91b60448201526064015b60405180910390fd5b60018054808201825560009190915261015d907fb10e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf6018383610355565b505050565b60005461010090046001600160a01b031633146101ad5760405162461bcd60e51b81526020600482015260096024820152683737ba16b7bbb732b960b91b6044820152606401610118565b600180546000916101bd91610586565b905080821461021957600181815481106101d9576101d96105fc565b90600052602060002001600183815481106101f6576101f66105fc565b9060005260206000200190805461020c906105ab565b6102179291906103d9565b505b600180548061022a5761022a6105e6565b6001900381819060005260206000200160006102469190610454565b90555050565b606060018281548110610261576102616105fc565b906000526020600020018054610276906105ab565b80601f01602080910402602001604051908101604052809291908181526020018280546102a2906105ab565b80156102ef5780601f106102c4576101008083540402835291602001916102ef565b820191906000526020600020905b8154815290600101906020018083116102d257829003601f168201915b50505050509050919050565b60005460ff1661030a57600080fd5b600180548082018255600091909152610346907fb10e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf6018383610355565b50506000805460ff1916905550565b828054610361906105ab565b90600052602060002090601f01602090048101928261038357600085556103c9565b82601f1061039c5782800160ff198235161785556103c9565b828001600101855582156103c9579182015b828111156103c95782358255916020019190600101906103ae565b506103d5929150610491565b5090565b8280546103e5906105ab565b90600052602060002090601f01602090048101928261040757600085556103c9565b82601f1061041857805485556103c9565b828001600101855582156103c957600052602060002091601f016020900482015b828111156103c9578254825591600101919060010190610439565b508054610460906105ab565b6000825580601f10610470575050565b601f01602090049060005260206000209081019061048e9190610491565b50565b5b808211156103d55760008155600101610492565b600080602083850312156104b957600080fd5b823567ffffffffffffffff808211156104d157600080fd5b818501915085601f8301126104e557600080fd5b8135818111156104f457600080fd5b86602082850101111561050657600080fd5b60209290920196919550909350505050565b60006020828403121561052a57600080fd5b5035919050565b600060208083528351808285015260005b8181101561055e57858101830151858201604001528201610542565b81811115610570576000604083870101525b50601f01601f1916929092016040019392505050565b6000828210156105a657634e487b7160e01b600052601160045260246000fd5b500390565b600181811c908216806105bf57607f821691505b602082108114156105e057634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052603160045260246000fd5b634e487b7160e01b600052603260045260246000fdfea2646970667358221220133eb8f68025eb29d5cdd7010e924d0328b3558269021e39ba78fcff9e5ecfea64736f6c63430008060033"

window.proxyCode = "0x608060405234801561001057600080fd5b5060405161011b38038061011b83398101604081905261002f91610063565b6000805460ff196001600160a01b0390931661010002929092166001600160a81b0319909216919091176001179055610093565b60006020828403121561007557600080fd5b81516001600160a01b038116811461008c57600080fd5b9392505050565b607a806100a16000396000f3fe608060405236600a57005b6040517343aac745e175327c8318dad817947342b12cc9a89036600082376000803683855af43d806000843e8180156040578184f35b8184fdfea2646970667358221220bc8f38f97764c5a8b611d5493ba62d37b30ca8f99988e448e88fabfd8c07a1f164736f6c63430008060033"

window.factoryBytecode = "0x608060405234801561001057600080fd5b506104b2806100206000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c8063ae22c57d1461003b578063cf5ba53f1461006a575b600080fd5b61004e610049366004610238565b61007f565b6040516001600160a01b03909116815260200160405180910390f35b61007d610078366004610268565b610149565b005b600080604051806020016100929061022b565b601f1982820381018352601f9091011660408181526001600160a01b038616602083015291925060009183910160408051601f19818403018152908290526100dd9291602001610315565b60408051601f1981840301815282825280516020918201206001600160f81b0319828501523060601b6bffffffffffffffffffffffff19166021850152600060358501526055808501919091528251808503909101815260759093019091528151910120949350505050565b60008060001b3360405161015c9061022b565b6001600160a01b0390911681526020018190604051809103906000f590508015801561018c573d6000803e3d6000fd5b5060405163f0fa2fe560e01b81529091506001600160a01b0382169063f0fa2fe5906101be9086908690600401610332565b600060405180830381600087803b1580156101d857600080fd5b505af11580156101ec573d6000803e3d6000fd5b50506040516001600160a01b03841692503391507f317bcb6686b1a5aeb829655c8a343994419551e7545c04dda5edbaa31fa80d8f90600090a3505050565b61011b8061036283390190565b60006020828403121561024a57600080fd5b81356001600160a01b038116811461026157600080fd5b9392505050565b6000806020838503121561027b57600080fd5b823567ffffffffffffffff8082111561029357600080fd5b818501915085601f8301126102a757600080fd5b8135818111156102b657600080fd5b8660208285010111156102c857600080fd5b60209290920196919550909350505050565b6000815160005b818110156102fb57602081850181015186830152016102e1565b8181111561030a576000828601525b509290920192915050565b600061032a61032483866102da565b846102da565b949350505050565b60208152816020820152818360408301376000818301604090810191909152601f909201601f1916010191905056fe608060405234801561001057600080fd5b5060405161011b38038061011b83398101604081905261002f91610063565b6000805460ff196001600160a01b0390931661010002929092166001600160a81b0319909216919091176001179055610093565b60006020828403121561007557600080fd5b81516001600160a01b038116811461008c57600080fd5b9392505050565b607a806100a16000396000f3fe608060405236600a57005b6040517343aac745e175327c8318dad817947342b12cc9a89036600082376000803683855af43d806000843e8180156040578184f35b8184fdfea2646970667358221220bc8f38f97764c5a8b611d5493ba62d37b30ca8f99988e448e88fabfd8c07a1f164736f6c63430008060033a26469706673582212205d9c5f43497fd2d1d58b06b980ae125e18132b92ef0f785bc08c91cb00e8ad9a64736f6c63430008060033"

window.MemoABI = [
  "function addMemo(bytes calldata memo) external",
  "function deleteMemo(uint i) external",
  "function memoCount() external view returns (uint)",
  "function getMemo(uint i) external view returns (bytes memory memo)"]

window.alertNoWallet = () => {
      alert("No wallet installed! Please install MetaMask or other web3 wallet to use this App.");
}

window.getMyContract = function(addr) {
  const addr32 = ethers.utils.hexZeroPad(addr, 32)
  const deployCode = window.proxyCode+addr32.substr(2) // using substr to skip 0x
  const deployCodeHash = ethers.utils.keccak256(deployCode)
  return ethers.utils.getCreate2Address(window.FactoryAddress, ethers.utils.hexZeroPad("0x0", 32), deployCodeHash);
}

//window.hexFromUint8Array = function(arr) {
//  return "0x"+arr.map(x => x.toString(16).padStart(2, '0')).join('');
//}

if (typeof window.ethereum === 'undefined') {
  alertNoWallet()
} else {
  await ethereum.request({ method: 'eth_requestAccounts' })
}

createApp(App).use(router).mount('#app')

